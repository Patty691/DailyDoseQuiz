# GenerateMedicationDatabase

## Objective

This program generates a JSON file containing medication clusters and their statistics. The JSON file is saved in the `data` folder of the project and is used in the quiz application to generate questions based on the statistics of the medication clusters. The JSON file is created from a CSV file containing medication data, which is sourced from the GIP database (the Dutch database for medication data).

---

## Key Information

### Output Vocabulary
- The output vocabulary of this program is **Dutch** because the input data is in Dutch, and the application is intended for Dutch users. While this might make the code harder to read for non-Dutch speakers, it is more practical for the intended use case.

### ATC Coding Terminology
- Officially, ATC coding uses the terms:
  - **ATC5** for codes like `"A02BC04"`
  - **ATC4** for codes like `"A02BC"`
- However, in practice, these codes are often referred to as **ATC7** (7 characters) and **ATC5** (5 characters). This program uses the **ATC7** and **ATC5** terminology to align with the number of characters in the codes.

### Input Data
- The input CSV file is based on the most recent data available (2023). Ensure that the headers in the CSV file match the expected format in the program.

---

## User Manual: Updating the CSV File

When updating the CSV file with a new version from the GIP database, follow these steps:

1. **Back Up Existing Files**:
   - Create a backup of the previous input CSV file and the output JSON file before overwriting them.

2. **Download the New CSV File**:
   - Go to the GIP database: [GIP Databank](https://www.gipdatabank.nl/databank?infotype=g&label=00-totaal&tabel_d_00-totaal=B_01-basis&tabel_g_00-totaal=R_46_top500_atclaatst&tabel_h_00-totaal=B_01-basis&geg=vs&spec=&item=)
   - Select the following options: Geneesmiddelen, Top 500, Uitgiftes, Geen specificatie
   - Copy the data as a CSV file.

3. **Prepare the CSV File**:
   - Ensure that all headers are in a single row. Manually adjust the file if necessary.
   - Verify that the headers match the expected names in the program. If needed:
     - Adjust the headers in the CSV file.
     - Update the code to reflect changes in the year columns.

4. **Replace the Old CSV File**:
   - Save the new CSV file in the appropriate location in the project.

---

## Example JSON Output

Below is an example of the JSON output generated by the program:

```json
{
  "A02BC": {
    "naam": "Protonpompremmers",
    "geneesmiddelen": [
      {
        "atc7": "A02BC02",
        "geneesmiddel": "Pantoprazol",
        "merknaam": "(Pantozol ®)",
        "verstrekkingen_huidig": 8094200,
        "verstrekkingen_vorig": 8046500,
        "percentage_verstrekkingen": 55.1,
        "groei_percentage": 0.6
      },
      {
        "atc7": "A02BC01",
        "geneesmiddel": "Omeprazol",
        "merknaam": "(Losec mups ®)",
        "verstrekkingen_huidig": 5280000,
        "verstrekkingen_vorig": 5583800,
        "percentage_verstrekkingen": 35.9,
        "groei_percentage": -5.4
      }
    ],
    "statistiek": {
      "aantal_geneesmiddelen": 2,
      "totaal_verstrekkingen_huidig": 13374200,
      "totaal_verstrekkingen_vorig": 13630300,
      "totaal_percentage_verstrekkingen": 91.0,
      "totaal_groeipercentage": -1.9
    }
  }
}

## Notes for Developers

### Code Structure
The program processes the CSV file, extracts ATC cluster names, calculates statistics, and generates a JSON file. The main functions include:

- **`adjust_csv`**: Prepares the CSV file for processing.
- **`name_atc_clusters`**: Maps ATC codes to cluster names.
- **`generate_medication_database`**: Combines all steps to generate the JSON output.

### Testing
Unit tests are available in the `tests` folder. To run the tests, use the following command:

```bash
python3 -m unittest discover tests
```